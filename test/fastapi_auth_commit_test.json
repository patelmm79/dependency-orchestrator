{
  "source_repo": "patelmm79/vllm-container-ngc",
  "consumer_repo": "patelmm79/resume-customizer",
  "test_changes": {
    "source_repo": "patelmm79/vllm-container-ngc",
    "commit_sha": "1865d05a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
    "commit_message": "Add API key authentication with FastAPI gateway and Secret Manager",
    "branch": "main",
    "changed_files": [
      {
        "path": "app.py",
        "change_type": "added",
        "diff": "+from fastapi import FastAPI, HTTPException, Security\n+from fastapi.security import APIKeyHeader\n+\n+API_KEY_HEADER = APIKeyHeader(name=\"X-API-Key\", auto_error=False)\n+\n+app = FastAPI()\n+\n+async def verify_api_key(api_key: str = Security(API_KEY_HEADER)):\n+    if not api_key:\n+        raise HTTPException(status_code=401, detail=\"Missing API key\")\n+    # Verify against Secret Manager\n+    return True"
      },
      {
        "path": "entrypoint.sh",
        "change_type": "modified",
        "diff": "-exec uvicorn vllm_server:app --host 0.0.0.0 --port 8080\n+# Start vLLM service on 8080\n+python -m vllm.entrypoints.openai.api_server --port 8080 &\n+# Start FastAPI gateway on 8000\n+exec uvicorn app:app --host 0.0.0.0 --port 8000"
      },
      {
        "path": "Dockerfile",
        "change_type": "modified",
        "diff": "+# Install FastAPI dependencies\n+RUN pip install fastapi uvicorn google-cloud-secret-manager\n+\n+# Copy FastAPI gateway\n+COPY app.py /app/app.py\n+\n+# Expose both ports\n-EXPOSE 8080\n+EXPOSE 8080 8000"
      },
      {
        "path": "README.md",
        "change_type": "modified",
        "diff": "+## Authentication\n+\n+This service now requires API key authentication via the X-API-Key header.\n+\n+```bash\n+curl -H \"X-API-Key: your-key\" http://localhost:8000/v1/completions\n+```\n+\n+## Ports\n+\n+- Port 8000: FastAPI gateway (authenticated)\n+- Port 8080: vLLM service (internal only)"
      }
    ],
    "pattern_summary": {
      "patterns": [
        "api_authentication",
        "deployment_configuration",
        "port_changes",
        "fastapi_integration"
      ],
      "keywords": [
        "authentication",
        "api_key",
        "fastapi",
        "secret_manager",
        "port",
        "gateway",
        "X-API-Key"
      ]
    },
    "timestamp": "2024-12-05T10:30:00Z"
  }
}
